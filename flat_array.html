<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <title>
        Test
    </title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
</head>

<body>
<div id="text" style="position:fixed;height:65px;">
</div>

<canvas id="my_canvas" moz-opaque="true" tabindex="1">
Sorry, but your browser does not support WebGL or does not have it
enabled.  To get a WebGL-enabled browser, please see:<br/>
  <a href="http://www.khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">
    Getting a WebGL Implementation
  </a>
</canvas>

<script type="text/javascript">

var textEl;
var setText = function setTextFn(msg)
{
    textEl.innerHTML = msg;
};

var canvas;
var setInterval = function setInterval(fn)
{
    var requestAnimationFrame =
        window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.oRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        window.mozRequestAnimationFrame;

    var wrap = function wrapFn()
    {
        fn();
        requestAnimationFrame(wrap, canvas);
    };
    wrap();
};

// =============================================================================

var main = function mainFn()
{
    var numParticles = 1000000;
    var particles = [];
    particles.length[(numParticles * 6) - 1] = 0;

    for (var i = 0 ; i < numParticles ; ++i)
    {
        particles[(i*6) + 0] = 1;
        particles[(i*6) + 1] = 2;
        particles[(i*6) + 2] = i;
        particles[(i*6) + 3] = 0;
        particles[(i*6) + 4] = 50;
        particles[(i*6) + 5] = 1;
    }

    var deltaTime = 0.0166;
    var accel = [ 0, -9.81, 0.1 ];
    var frame = 60;

    setInterval(function () {

        var p = particles;
        var dt = deltaTime;
        var a = accel;

        for (var i = 0 ; i < numParticles ; ++i)
        {
            var pb = 6*i;

            var vel_x = p[pb+3];
            var vel_y = p[pb+4]
            var vel_z = p[pb+5];

            p[pb+0] += deltaTime * vel_x;
            p[pb+1] += deltaTime * vel_y;
            p[pb+2] += deltaTime * vel_z;

            p[pb+3] = vel_x + (deltaTime * a[0]);
            p[pb+4] = vel_y + (deltaTime * a[1]);
            p[pb+5] = vel_z + (deltaTime * a[2]);
        }

        if (60 <= ++frame)
        {
            p = particles;
            setText("particle[0]: " + p[0] + ", " + p[1] + ", " + p[2]);
            frame = 0;
        }

    });
};

window.onload = function ()
{
    textEl = document.getElementById("text");
    canvas = document.getElementById('turbulenz_game_engine_canvas');

    main();
};

</script>

</body>
