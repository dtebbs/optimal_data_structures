<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <title>
        Test
    </title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
</head>

<body>

<div id="fps" style="height:65px;">
</div>

<div id="text" style="height:65px;">
</div>

<canvas id="my_canvas" moz-opaque="true" tabindex="1">
Sorry, but your browser does not support WebGL or does not have it
enabled.  To get a WebGL-enabled browser, please see:<br/>
  <a href="http://www.khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">
    Getting a WebGL Implementation
  </a>
</canvas>

<script type="text/javascript" src="framework.js">
</script>

<script type="text/javascript">

// =============================================================================

var main = function mainFn()
{
    var numParticles = 1000000;

    var particles_posx = [];
    // particles_posx.length = numParticles;
    // particles_posx[numParticles-1] = 0;
    var particles_posy = [];
    // particles_posy.length = numParticles;
    // particles_posy[numParticles-1] = 0;
    var particles_posz = [];
    // particles_posz.length = numParticles;
    // particles_posz[numParticles-1] = 0;
    var particles_velx = [];
    // particles_velx.length = numParticles;
    // particles_velx[numParticles-1] = 0;
    var particles_vely = [];
    // particles_vely.length = numParticles;
    // particles_vely[numParticles-1] = 0;
    var particles_velz = [];
    // particles_velz.length = numParticles;
    // particles_velz[numParticles-1] = 0;

    // var particles_posx = new Array(numParticles);
    // var particles_posy = new Array(numParticles);
    // var particles_posz = new Array(numParticles);
    // var particles_velx = new Array(numParticles);
    // var particles_vely = new Array(numParticles);
    // var particles_velz = new Array(numParticles);

    for (var i = 0 ; i < numParticles ; ++i)
    {
        particles_posx[i] = 1;
        particles_posy[i] = 2;
        particles_posz[i] = i;
        particles_velx[i] = 0;
        particles_vely[i] = 50;
        particles_velz[i] = 1;
    }

    var deltaTime = 0.0166;
    var accel = [ 0, -9.81, 0.1 ];
    var frame = 60;

    // Inner Loop

    setInterval(function () {

        var p_posx = particles_posx;
        var p_posy = particles_posy;
        var p_posz = particles_posz;
        var p_velx = particles_velx;
        var p_vely = particles_vely;
        var p_velz = particles_velz;

        var numP = numParticles;

        var dt = deltaTime;
        var a = accel;

        var ax = accel[0];
        var ay = accel[1];
        var az = accel[2];

        var vel_x;
        var vel_y;
        var vel_z;

        for (var i = 0 ; i < numP ; ++i)
        {
            vel_x = p_velx[i];
            vel_y = p_vely[i];
            vel_z = p_velz[i];

            p_posx[i] += dt * vel_x;
            p_posy[i] += dt * vel_y;
            p_posz[i] += dt * vel_z;

            p_velx[i] = vel_x + (dt * ax);
            p_vely[i] = vel_y + (dt * ay);
            p_velz[i] = vel_z + (dt * az);
        }

        if (60 <= ++frame)
        {
            setText("particle[0]: " + p_posx[0] + ", " + p_posy[1] + ", " + p_posz[2]);
            frame = 0;
        }

    });
};

</script>

</body>
